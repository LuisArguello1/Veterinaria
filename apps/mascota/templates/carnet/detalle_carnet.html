{% extends 'layouts/dashboard.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/carnet.css' %}">
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">

    <!-- Navegación -->
    {% include "components/breadcrumbs.html" with breadcrumbs=breadcrumb_list %}


    <!-- Carnet Detallado -->
    <div class="bg-white rounded-lg shadow-lg max-w-4xl mx-auto">
        <!-- Header del Carnet -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-lg">
            <div class="text-center">
                <h1 class="text-3xl font-bold mb-2">CARNET DE IDENTIFICACIÓN</h1>
                <p class="text-blue-100">Sistema PetFaceID</p>
            </div>
        </div>

        <div class="p-8">
            <!-- Información Principal con Fotos -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                <!-- Foto de la Mascota -->
                <div class="text-center">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Mascota</h3>
                    <div class="w-32 h-32 mx-auto rounded-full overflow-hidden bg-gray-200 mb-4 shadow-lg">
                        {% if mascota.foto_perfil %}
                            <img src="{{ mascota.foto_perfil.url }}" 
                                 alt="Foto de {{ mascota.nombre }}" 
                                 class="w-full h-full object-cover">
                        {% else %}
                            <div class="w-full h-full flex items-center justify-center text-gray-400">
                                <svg class="w-16 h-16" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                        {% endif %}
                    </div>
                    <h4 class="text-xl font-bold text-gray-800">{{ mascota.nombre }}</h4>
                    <p class="text-gray-600">{{ mascota.raza|default:"Sin raza especificada" }}</p>
                </div>

                <!-- Información de la Mascota -->
                <div class="lg:col-span-1">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Información de la Mascota</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between border-b border-gray-200 pb-2">
                            <span class="font-medium text-gray-600">Sexo:</span>
                            <span class="text-gray-800">{{ mascota.sexo_display }}</span>
                        </div>
                        <div class="flex justify-between border-b border-gray-200 pb-2">
                            <span class="font-medium text-gray-600">Edad:</span>
                            <span class="text-gray-800">{{ mascota.edad_completa }}</span>
                        </div>
                        <div class="flex justify-between border-b border-gray-200 pb-2">
                            <span class="font-medium text-gray-600">Peso:</span>
                            <span class="text-gray-800">
                                {% if mascota.peso %}{{ mascota.peso }} kg{% else %}No especificado{% endif %}
                            </span>
                        </div>
                        <div class="flex justify-between border-b border-gray-200 pb-2">
                            <span class="font-medium text-gray-600">Color:</span>
                            <span class="text-gray-800">{{ mascota.color|default:"No especificado" }}</span>
                        </div>
                        <div class="flex justify-between border-b border-gray-200 pb-2">
                            <span class="font-medium text-gray-600">Estado Corporal:</span>
                            <span class="text-gray-800">
                                {% if mascota.estado_corporal %}{{ mascota.get_estado_corporal_display }}{% else %}No especificado{% endif %}
                            </span>
                        </div>
                        <div class="flex justify-between border-b border-gray-200 pb-2">
                            <span class="font-medium text-gray-600">Etapa de Vida:</span>
                            <span class="text-gray-800">{{ mascota.etapa_vida_display }}</span>
                        </div>
                        <div class="flex justify-between border-b border-gray-200 pb-2">
                            <span class="font-medium text-gray-600">Fecha de Nacimiento:</span>
                            <span class="text-gray-800">
                                {% if mascota.fecha_nacimiento %}{{ mascota.fecha_nacimiento|date:"d/m/Y" }}{% else %}No especificada{% endif %}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Foto del Propietario -->
                <div class="text-center">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Propietario</h3>
                    <div class="w-32 h-32 mx-auto rounded-full overflow-hidden bg-gray-200 mb-4 shadow-lg">
                        {% if propietario.image %}
                            <img src="{{ propietario.image.url }}" 
                                 alt="Foto de {{ propietario.first_name }}" 
                                 class="w-full h-full object-cover">
                        {% else %}
                            <div class="w-full h-full flex items-center justify-center text-gray-400">
                                <svg class="w-16 h-16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                        {% endif %}
                    </div>
                    <h4 class="text-xl font-bold text-gray-800">
                        {{ propietario.first_name }} {{ propietario.last_name }}
                    </h4>
                    <p class="text-gray-600">@{{ propietario.username }}</p>
                </div>
            </div>

            <!-- Información del Propietario -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Contacto del Propietario</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between border-b border-gray-200 pb-2">
                            <span class="font-medium text-gray-600">Email:</span>
                            <span class="text-gray-800">{{ propietario.email }}</span>
                        </div>
                        <div class="flex justify-between border-b border-gray-200 pb-2">
                            <span class="font-medium text-gray-600">Teléfono:</span>
                            <span class="text-gray-800">{{ propietario.phone|default:"No especificado" }}</span>
                        </div>
                        <div class="flex justify-between border-b border-gray-200 pb-2">
                            <span class="font-medium text-gray-600">Dirección:</span>
                            <span class="text-gray-800">{{ propietario.direction|default:"No especificada" }}</span>
                        </div>
                        <div class="flex justify-between border-b border-gray-200 pb-2">
                            <span class="font-medium text-gray-600">Cédula:</span>
                            <span class="text-gray-800">{{ propietario.dni|default:"No especificada" }}</span>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Información del Sistema</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between border-b border-gray-200 pb-2">
                            <span class="font-medium text-gray-600">Fecha de Registro:</span>
                            <span class="text-gray-800">{{ mascota.created_at|date:"d/m/Y H:i" }}</span>
                        </div>
                        <div class="flex justify-between border-b border-gray-200 pb-2">
                            <span class="font-medium text-gray-600">Estado:</span>
                            <span class="text-gray-800">
                                {% if mascota.reportar_perdida %}
                                    <span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm">⚠️ Reportada como perdida</span>
                                {% else %}
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">✅ En casa</span>
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Características Especiales -->
            {% if mascota.caracteristicas_especiales %}
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Características Especiales</h3>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-gray-700">{{ mascota.caracteristicas_especiales }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Códigos QR y Biometría -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div class="text-center">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Código QR</h3>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        {% if mascota.uuid %}
                            <p class="text-sm text-gray-600 mb-2">Escanea para acceso público</p>
                            <a href="{% url 'mascota:qr_info_publica' mascota.uuid %}" 
                               class="text-blue-600 hover:text-blue-800 text-sm">
                                Ver información pública →
                            </a>
                        {% else %}
                            <p class="text-sm text-gray-500">UUID no asignado</p>
                        {% endif %}
                    </div>
                </div>

                <div class="text-center">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Estado Biométrico</h3>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600 mb-2">
                            Imágenes registradas: {{ mascota.imagenes_count }}
                        </div>
                        {% if mascota.biometria_entrenada %}
                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded text-sm flex items-center justify-center gap-2">
                                <i class="fas fa-check-circle"></i> Reconocimiento activo
                            </span>
                        {% else %}
                            <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded text-sm flex items-center justify-center gap-2">
                                <i class="fas fa-hourglass-half"></i> Pendiente entrenamiento
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Acciones -->
            <div class="flex flex-wrap gap-4 justify-center border-t border-gray-200 pt-6">
                <a href="{% url 'mascota:lista_carnets' %}" 
                   class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-6 rounded-md transition-colors font-medium flex items-center gap-2">
                    <i class="fas fa-arrow-left"></i> Volver a Carnets
                </a>
                
                <a href="{% url 'mascota:vista_previa_carnet' mascota.id %}" 
                   class="bg-green-600 hover:bg-green-700 text-white py-2 px-6 rounded-md transition-colors font-medium flex items-center gap-2">
                    <i class="fas fa-print"></i> Vista Previa para Imprimir
                </a>
                
                {% if pdf_available %}
                <a href="{% url 'mascota:descargar_carnet_pdf' mascota.id %}" 
                   class="bg-red-600 hover:bg-red-700 text-white py-2 px-6 rounded-md transition-colors font-medium flex items-center gap-2">
                    <i class="fas fa-file-pdf"></i> Descargar PDF
                </a>
                {% endif %}
                
                <a href="{% url 'mascota:main_register' %}" 
                   class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-md transition-colors font-medium flex items-center gap-2">
                    <i class="fas fa-info-circle"></i> Ver Detalle Mascota
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/carnet.js' %}"></script>
{% endblock %}